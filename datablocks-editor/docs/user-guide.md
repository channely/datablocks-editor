# DataBlocks Editor 用户指南

## 目录

1. [快速开始](#快速开始)
2. [界面介绍](#界面介绍)
3. [节点类型详解](#节点类型详解)
4. [数据流构建](#数据流构建)
5. [高级功能](#高级功能)
6. [常见问题](#常见问题)
7. [最佳实践](#最佳实践)

## 快速开始

### 第一次使用

1. **启动应用**
   - 在浏览器中打开 DataBlocks Editor
   - 您将看到一个空白的画布和左侧的节点面板

2. **创建您的第一个数据流**
   - 从左侧节点面板拖拽一个"示例数据"节点到画布
   - 拖拽一个"表格"节点到画布
   - 将示例数据节点的输出连接到表格节点的输入
   - 点击执行按钮查看结果

### 基本操作

- **拖拽节点**: 从左侧面板拖拽节点到画布
- **连接节点**: 点击节点的输出端口，拖拽到另一个节点的输入端口
- **选择节点**: 点击节点进行选择，右侧将显示属性面板
- **删除节点**: 选择节点后按 Delete 键
- **执行数据流**: 点击顶部工具栏的执行按钮

## 界面介绍

### 主要区域

1. **顶部工具栏**
   - 执行按钮：运行整个数据流
   - 撤销/重做按钮
   - 保存按钮
   - 设置按钮

2. **左侧节点面板**
   - 输入节点：数据源节点
   - 处理节点：数据转换节点
   - 输出节点：数据展示和导出节点

3. **中央画布区域**
   - 数据流构建区域
   - 支持缩放和平移
   - 网格背景辅助对齐

4. **右侧属性面板**
   - 显示选中节点的配置选项
   - 实时预览节点输出数据

5. **底部数据预览面板**
   - 显示节点的输出数据
   - 支持表格和JSON格式查看

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + Z` | 撤销操作 |
| `Ctrl/Cmd + Y` | 重做操作 |
| `Delete` | 删除选中的节点或连接 |
| `Ctrl/Cmd + S` | 保存项目 |
| `Space + 拖拽` | 平移画布 |
| `Ctrl/Cmd + 滚轮` | 缩放画布 |

## 节点类型详解

### 输入节点

#### 文件输入节点
- **功能**: 上传并解析文件数据
- **支持格式**: CSV、JSON、Excel (.xlsx, .xls)
- **配置选项**:
  - 文件选择器
  - 编码设置 (UTF-8, GBK等)
  - 分隔符设置 (仅CSV)
  - 首行作为标题选项

#### 粘贴输入节点
- **功能**: 直接粘贴表格数据或JSON数据
- **支持格式**: 
  - 表格数据 (从Excel、Google Sheets等复制)
  - JSON格式数据
  - CSV格式文本
- **配置选项**:
  - 数据格式选择
  - 分隔符设置
  - 数据预览

#### HTTP请求节点
- **功能**: 从REST API获取数据
- **配置选项**:
  - URL地址
  - 请求方法 (GET, POST, PUT, DELETE)
  - 请求头设置
  - 请求体 (JSON格式)
  - 认证设置
- **示例**:
  ```json
  {
    "url": "https://api.example.com/data",
    "method": "GET",
    "headers": {
      "Authorization": "Bearer your-token"
    }
  }
  ```

#### 示例数据节点
- **功能**: 提供预置的示例数据集
- **可用数据集**:
  - 销售数据
  - 用户数据
  - 产品数据
  - 时间序列数据

### 处理节点

#### 过滤节点
- **功能**: 根据条件筛选数据行
- **配置选项**:
  - 列选择
  - 操作符 (等于、不等于、大于、小于、包含等)
  - 过滤值
  - 多条件组合 (AND/OR)

#### 排序节点
- **功能**: 对数据进行排序
- **配置选项**:
  - 排序列选择
  - 排序方向 (升序/降序)
  - 多列排序支持

#### 分组节点
- **功能**: 数据分组和聚合计算
- **配置选项**:
  - 分组列选择
  - 聚合函数 (求和、平均值、计数、最大值、最小值)
  - 聚合列选择

#### JavaScript节点
- **功能**: 自定义JavaScript代码处理数据
- **输入格式**:
  ```javascript
  {
    columns: ["列名1", "列名2", ...],
    rows: [
      ["值1", "值2", ...],
      ["值3", "值4", ...],
      ...
    ]
  }
  ```
- **代码模板**:
  ```javascript
  function process(data) {
    // 在这里编写您的数据处理逻辑
    // data.columns 包含列名数组
    // data.rows 包含数据行数组
    
    // 示例：过滤数据
    const filteredRows = data.rows.filter(row => {
      return row[0] > 100; // 假设第一列是数值
    });
    
    return {
      columns: data.columns,
      rows: filteredRows
    };
  }
  ```

### 输出节点

#### 图表节点
- **功能**: 数据可视化
- **支持图表类型**:
  - 柱状图 (Bar Chart)
  - 折线图 (Line Chart)
  - 散点图 (Scatter Plot)
  - 饼图 (Pie Chart)
  - 面积图 (Area Chart)
- **配置选项**:
  - 图表类型选择
  - X轴列选择
  - Y轴列选择
  - 颜色设置
  - 标题和标签

#### 表格节点
- **功能**: 以表格形式展示数据
- **配置选项**:
  - 分页设置
  - 列宽调整
  - 排序功能
  - 搜索功能

#### 导出节点
- **功能**: 导出处理后的数据
- **支持格式**:
  - CSV文件
  - JSON文件
  - Excel文件
- **配置选项**:
  - 导出格式选择
  - 文件名设置
  - 编码选择

## 数据流构建

### 基本概念

- **节点**: 数据处理的基本单元
- **连接**: 节点之间的数据流向
- **端口**: 节点的输入和输出接口
- **数据格式**: 统一的表格数据格式

### 构建步骤

1. **规划数据流**
   - 确定数据源
   - 明确处理需求
   - 设计输出形式

2. **添加节点**
   - 从左侧面板拖拽所需节点
   - 按照数据流向排列节点

3. **配置节点**
   - 选择节点查看属性面板
   - 根据需求配置参数

4. **连接节点**
   - 从输出端口拖拽到输入端口
   - 确保数据类型匹配

5. **测试执行**
   - 点击执行按钮
   - 检查输出结果
   - 调整配置

### 数据流示例

#### 示例1：销售数据分析
```
文件输入 → 过滤(销售额>1000) → 分组(按地区) → 图表(柱状图)
```

#### 示例2：API数据处理
```
HTTP请求 → JavaScript(数据清洗) → 排序(按时间) → 表格显示
```

## 高级功能

### JavaScript节点高级用法

#### 数据统计
```javascript
function process(data) {
  const stats = {};
  
  data.columns.forEach((col, index) => {
    const values = data.rows
      .map(row => row[index])
      .filter(val => typeof val === 'number');
    
    if (values.length > 0) {
      stats[col] = {
        min: Math.min(...values),
        max: Math.max(...values),
        avg: values.reduce((a, b) => a + b, 0) / values.length,
        count: values.length
      };
    }
  });
  
  return {
    columns: ['指标', '最小值', '最大值', '平均值', '数量'],
    rows: Object.entries(stats).map(([col, stat]) => [
      col, stat.min, stat.max, stat.avg.toFixed(2), stat.count
    ])
  };
}
```

#### 数据转换
```javascript
function process(data) {
  // 将宽表转换为长表
  const result = {
    columns: ['维度', '指标', '值'],
    rows: []
  };
  
  data.rows.forEach(row => {
    const dimension = row[0]; // 假设第一列是维度
    for (let i = 1; i < data.columns.length; i++) {
      result.rows.push([
        dimension,
        data.columns[i],
        row[i]
      ]);
    }
  });
  
  return result;
}
```

### 性能优化

#### 大数据集处理
- 使用数据采样减少处理量
- 启用数据缓存避免重复计算
- 合理使用过滤节点减少数据量

#### 内存管理
- 定期清理不需要的数据
- 避免在JavaScript节点中创建大量临时对象
- 使用流式处理处理大文件

## 常见问题

### 数据相关

**Q: 上传的CSV文件中文显示乱码**
A: 在文件输入节点中选择正确的编码格式，通常中文文件使用GBK编码。

**Q: JSON数据解析失败**
A: 检查JSON格式是否正确，可以使用在线JSON验证工具验证格式。

**Q: 图表显示异常**
A: 确认数据类型是否匹配图表要求，数值列应为数字类型。

### 操作相关

**Q: 节点无法连接**
A: 检查输出节点的数据类型是否与输入节点兼容。

**Q: 执行时报错**
A: 查看错误信息，通常是配置参数不正确或数据格式不匹配。

**Q: 性能较慢**
A: 启用数据缓存，减少数据量，优化JavaScript代码。

### JavaScript节点

**Q: 代码执行超时**
A: 检查代码是否有死循环，优化算法复杂度。

**Q: 无法访问外部API**
A: JavaScript节点运行在沙箱环境中，无法直接访问外部资源，请使用HTTP请求节点。

## 最佳实践

### 数据流设计

1. **模块化设计**
   - 将复杂的数据处理分解为多个简单步骤
   - 每个节点只负责一个特定功能

2. **错误处理**
   - 在关键节点添加数据验证
   - 使用JavaScript节点进行异常处理

3. **性能考虑**
   - 尽早过滤数据减少后续处理量
   - 合理使用缓存机制

### 代码规范

1. **JavaScript节点**
   - 添加注释说明处理逻辑
   - 使用有意义的变量名
   - 进行输入数据验证

2. **数据格式**
   - 保持数据格式的一致性
   - 使用标准的列名和数据类型

### 项目管理

1. **版本控制**
   - 定期保存项目
   - 为重要版本添加备注

2. **文档记录**
   - 记录数据流的业务逻辑
   - 说明关键参数的含义

## 故障排除

### 系统要求
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **内存**: 建议4GB以上可用内存
- **网络**: 稳定的网络连接（用于HTTP请求节点）

### 性能优化建议

#### 处理大数据集
1. **数据采样**: 对于超过10万行的数据，建议先进行采样
2. **分批处理**: 将大数据集分割为较小的批次处理
3. **内存监控**: 注意浏览器内存使用情况，必要时刷新页面

#### 优化数据流
1. **早期过滤**: 在数据流的早期阶段进行过滤，减少后续处理的数据量
2. **避免重复计算**: 使用缓存机制避免重复的数据处理
3. **简化JavaScript代码**: 避免复杂的循环和递归操作

### 数据安全

#### 本地存储
- 所有数据处理都在浏览器本地进行
- 项目数据存储在浏览器的IndexedDB中
- 不会向服务器发送任何用户数据（除非使用HTTP请求节点）

#### 隐私保护
- 清除浏览器数据会删除所有保存的项目
- 建议定期导出重要项目作为备份
- 敏感数据处理时建议使用隐私模式

### 兼容性说明

#### 浏览器支持
| 浏览器 | 最低版本 | 推荐版本 | 备注 |
|--------|----------|----------|------|
| Chrome | 90 | 最新版 | 最佳性能 |
| Firefox | 88 | 最新版 | 良好支持 |
| Safari | 14 | 最新版 | 部分功能限制 |
| Edge | 90 | 最新版 | 良好支持 |

#### 功能限制
- **Safari**: Web Workers性能较差，大数据处理可能较慢
- **移动浏览器**: 界面适配有限，建议使用桌面浏览器
- **IE**: 不支持，请使用现代浏览器

## 更新日志

### v1.0.0 (2025-01-18)
- 🎉 首次发布
- ✨ 支持基础的节点编辑功能
- ✨ 实现数据输入、处理、可视化节点
- ✨ 添加JavaScript自定义处理节点
- ✨ 支持项目保存和加载
- ✨ 实现错误处理和用户反馈系统

### 计划功能
- 🔄 实时协作编辑
- 📊 更多图表类型支持
- 🔌 插件系统
- 📱 移动端适配
- 🌐 多语言支持

---

**版本**: v1.0.0  
**最后更新**: 2025年1月18日  
**文档版本**: 1.0